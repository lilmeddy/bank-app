<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="dash.css">
    <script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore-compat.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script>
    firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    // User is signed in, see docs for a list of available properties
    // https://firebase.google.com/docs/reference/js/v8/firebase.User
    var uid = user.uid;
    // ...
  } else {
    window.location.href ="login.html"
  }
});
</script>


    </head>

<body>
    <div id="scrn" style=" font-size: 150px; width: 20%; height: 50%; margin: 200px auto;">
        <i class='bx bx-rotate-right bx-spin bx-rotate-90' style="color: blue;"></i>
    </div>
    <aside class="aside" id="load">

        <div class="top" style="padding-top: 15px;">
            <i class="bx bx-menu" id="bot" style="padding-top: 15px;"></i>
            <div class="logo">
                <img src="https://dashboard.piggyvest.com/static/media/piggyvest-logo.0b78a8fa.svg" alt="">
            </div>

        </div>
        <ul class="ul">
            <li class="li">
                <a href="" class=" sap">
                    <i class='bx bxs-home'></i>
                    <span class="nav-item">Home</span>
                </a>
            </li>

            <li class="li">
                <a href="save.html" class=" sap save">
                    <i class='bx bx-target-lock'></i>
                    <span class="nav-item">Savings</span>
                </a>
            </li>

            <li class="li">
                <a href="" class=" sap">
                    <i class='bx bxs-rocket'></i>
                    <span class="nav-item">Invest</span>
                </a>
            </li>

            <li class="li">
                <a href="account.html" class=" sap">
                    <i class='bx bx-user'></i>
                    <span class="nav-item">Account</span>
                </a>
            </li>

            <li class="li move">
                <button onclick="log()" class=" sap" style="background-color: transparent;border: none;">
                    <i class='bx bx-power-off'></i>
                    <span class="nav-item">Logout</span>
                </button>
            </li>
        </ul>

    </aside>
    <main class="main" id="screen">
        <section class="section1">
            <div class="d-flex align-items-center justify-content-between mt-3">
                <div class="name">
                    <h1 id="lastName"></h1>
                    <p>wash your hands, it's lunch time üçõ!</p>
                </div>
                <div>
                    <a href="details.html" class="btn">
                        <i class='bx bxs-user-circle bx-burst' style='color:#045dd4' id="photo"></i>
                    </a>
                </div>

        </section>
        <section>
            <div class="row">
                <div class="col-lg-1">
                    <i class='bx bxs-low-vision bx-tada'></i>
                </div>
                <div class="col-lg-11 text-end">
                    <p    class="btn nam" id="transaction">Transaction History</p>
                    <p   class="btn nam" id="fund">Fund</p>
                    <button onclick="myTransfer()" style="background-color: transparent;border: none;"><p  class="btn nam" >Transfer</p></button>
                    <button onclick="myAirtime()" style="background-color: transparent;border: none;"><p  class="btn nam" >Buy Airtime</p></button>
                    <!-- <p   class="btn nam" id="airtime"></p> -->
                    <p   class="btn nam" id="save">+ QUICK SAVE</p>
                </div>
            </div>
        </section>
        <section class="overflow">
            <div class="blac" style="background-color:rgba(86, 16, 216, 0.726) ;">
                <div class="icon">
                    <i>@</i>
                </div>
                <div class="text">
                    <h1 id="firstName"></h1>
                    <p id="raydee"></p>
                </div>
            </div>
            <div class="blac" style="background-color:rgb(16,98,216) ;">
                <div class="icon">
                    <i class='bx bx-shield' style='color:#fff'></i>
                </div>
                <div class="text">
                    <h1>Total Savings</h1>
                    <p id="saving">‚Ç¶14.28</p>
                </div>
            </div>
            <div class="blac" style="background-color:rgb(121, 19, 212);">
                <div class="icon">
                    <i class='bx bx-line-chart'></i>
                </div>
                <div class="text">
                    <h1>Total Investments</h1>
                    <p id="invest">‚Ç¶14.28</p>
                </div>
            </div>
            <div class="blac" style="background-color: rgba(8, 8, 8, 0.89);">
                <div class="icon">
                    <i class='bx bx-dollar'></i>
                </div>
                <div class="text">
                    <h1>Flex Dollars</h1>
                    <p id="dollar">‚Ç¶14.28</p>
                </div>
            </div>
            <div class="blac" style="background-color: #fff;color: rgb(231,67,156); border: 1px solid #fff">
                <div class="icon">
                    <i class='bx bxs-wallet'></i>
                </div>
                <div class="text">
                    <h1>Flex Naira</h1>
                    <p id="naira">‚Ç¶14.28</p>
                </div>
            </div>
        </section>
        <section class="list-flex">
            <div class="todo">
              <p>TO-DO LIST</p>
              <div class="to">
                <input type="radio" name="" id="">
                <span>Turn on your Piggybank AutoSave üö¶ </span>
              </div>
              <div class="to">
                <input type="radio" name="" id="">
                <span> Safelock ‚Ç¶50,001 for 61 - 90 days
                   </span>
              </div>
              <div class="to">
                <input type="radio" name="" id="">
                <span> Set your security question now! üîê üîê</span>
              </div>
              <div class="too">
                <div><i class='bx bx-gift'></i></div>
                <div><h5>
                    Get Piggybank Savings Interest for July!
                </h5>
                    <p>Tap to earn interest on Your Piggybank Savings for July</p>
                </div>
              </div>
              <div class="too">
                <div><i class='bx bx-gift'></i></div>
                <div><h5>
                    Get Piggybank Savings Interest for July!
                </h5>
                    <p>Tap to earn interest on Your Piggybank Savings for July</p>
                </div>
              </div>
              <div class="too">
                <div><i class='bx bx-gift'></i></div>
                <div><h5>
                    Get Piggybank Savings Interest for July!
                </h5>
                    <p>Tap to earn interest on Your Piggybank Savings for July</p>
                </div>
              </div>
            </div>
            <div class="best">
                <p>SAVER OF THE MONTH: TOLA</p>
                <img src="https://storage.googleapis.com/piggybankservice.appspot.com/main-assets/banner2be2fabdd9.jpeg" alt="">
            </div>
        </section>
      <div id="airtime">
        <button onclick="bak()"><i class='bx bx-chevron-left bx-flashing'></i></button>
        <input type="number" id="airtimeAmount" placeholder="Amount">
        <button onclick="buyAirtime()">Buy Airtime</button>
      </div>
        <section id="transferr">
            <div class="right">
                <button onclick="back()"><i class='bx bx-chevron-left bx-flashing'></i></button>
                <p>Transfer to PiggyVest Account</p>
            </div>
            <div class="left">
                <button onclick="his()">History</button>
            </div>
            <div class="recipeient">
                <div style="border-bottom: 1px solid blue; height: fit-content;"><input id="digits" type="number" placeholder="Enter 10 digits Account Number">
                <button onclick="sho()" ><i class='bx bx-check' style="color:blue"></i></button></div>
                <h1 id="showName"></h1>
                <button onclick="pay()" id="">Next</button>
            </div>
        </section>

        <section id="payment">
            <div><img src="./Images/logo.svg" alt=""></div>
            <h1 id="payName"></h1>
            <p>PiggyVest(<span id="payAcc"></span>)</p>
            <label for="">Amount</label>
            <div><span>‚Ç¶</span><input type="number" id="payAmt" placeholder="100.00-5,000,000.00"></div>
            <label for="">Remark</label><br>
            <input type="text" placeholder="What's this for?(Optional)" id="rem"><br>
            <button onclick="showPin()">Confirm</button>


            <div id="trans">

                <button onclick="bac()"><i class='bx bx-chevron-left bx-flashing'></i></button>
                <div class="payFlex">
                    <p>Bank</p>
                    <h1>PiggyVest</h1>
                </div>
                <div class="payFlex">
                    <p>Account Number</p>
                    <h1 id="tranNum"></h1>
                </div>
                <div class="payFlex">
                    <p>Name</p>
                    <h1 id="tranNam"></h1>
                </div>
                <div class="payFlex">
                    <p>Amount</p>
                    <h1 id="tranAmount"></h1>
                </div>
                <div class="payFlex">
                    <p>Remark</p>
                    <h1 id="tranRem"></h1>
                </div>
                <div>
                    <p>Payment method</p>
                </div>
                <div id="method"></div>
                <div>
                    <label for="">Enter Pin</label>
                    <input type="numbers" id="final" placeholder="Enter Pin">
                </div>
                <button onclick="show()">Pay</button>
            </div>
            <div id="reciept">

            </div>
        </section>
    </main>

</body>

</html>

<script>

    const firebaseConfig = {
        apiKey: "AIzaSyCZRt5ZugU3gYBuKEWAAdbgdtCoIuizGJ4",
        authDomain: "bank-56c80.firebaseapp.com",
        projectId: "bank-56c80",
        storageBucket: "bank-56c80.appspot.com",
        messagingSenderId: "278093243224",
        appId: "1:278093243224:web:268d9c364c7d4e5f577b2d"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
</script>
<script>
 

   const user = firebase.auth().currentUser;
   console.log(user);
//    let logs = document.getElementById("log")
    let lastName = document.getElementById("lastName")
    let firstName = document.getElementById("firstName")
    let raydee = document.getElementById("raydee")
    let screen = document.getElementById("screen")
    let scrn = document.getElementById("scrn")
    let load = document.getElementById("load")
    let transfer = document.getElementById("transfer")
    let transferr = document.getElementById("transferr")
    let digits = document.getElementById("digits")
    let showName = document.getElementById("showName")
    let payment = document.getElementById("payment")
    let payName = document.getElementById("payName")
    let payAcc = document.getElementById("payAcc")
    let payAmt = document.getElementById("payAmt")
    let trans = document.getElementById("trans")
    let tranNum = document.getElementById("tranNum")
    let tranNam = document.getElementById("tranNam")
    let tranAmount = document.getElementById("tranAmount")
    let method = document.getElementById("method")
    let reciept = document.getElementById("reciept")
    let rem = document.getElementById("rem")
    let tranRem = document.getElementById("tranRem")
    scrn.style.display = "block"
    screen.style.display = "none"
    load.style.display = "none"
    function authAll(){
        firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    var uid = user.uid;
    var docRef = db.collection("account").doc(`${user.uid}`);

    docRef.get().then((doc) => {
        if (doc.exists) {
               scrn.style.display = "none"
                screen.style.display = "block"
                load.style.display = "block"
                lastName.textContent = ` ${doc.data().last}`
                firstName.textContent = ` ${doc.data().displayName} pocket`
                raydee.textContent = `‚Ç¶${doc.data().balance}`
               console.log("Document data:", doc.data());
  

        } else {
            console.log("No such document!");
        }
    }).catch((error) => {
        console.log("Error getting document:", error);
    });

  } else {
    window.location.href ="login.html"
  }
});  
    }
    
 authAll()
    

         function log(){
            firebase.auth().signOut().then(() => {
  alert ("Sign-out successful.")
  window.location.href ="index.html"
}).catch((error) => {
});
         }
         function myAirtime(){
   airtime.style.display="block"
    }
    function buyAirtime(){
        const amountInput = document.getElementById("airtimeAmount");
    const amount = amountInput.value;
        firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    var uid = user.uid;
    console.log(uid);
    var docRef = db.collection("account").doc(`${uid}`);
    docRef.get().then((doc) => {
        if (doc.exists) {
            const userData = doc.data();
            console.log(userData);
            const currentBalance = userData.balance;
            console.log(currentBalance);
            if (currentBalance >= amount) {
                const newBalance = currentBalance - amount;
                console.log(newBalance);
                console.log(amount);
                db.collection("account").doc(uid).update({
                    balance: newBalance
                }).then(() => {
                    raydee.textContent = ` ‚Ç¶${newBalance.toFixed(2)}`;

                }).catch(error => {
                    console.error("Error updating balance:", error);
                });
            }else{
                alert("insufficient balance")
            }
        }
        })
        } else {
            console.log("No such document!");
        }
    }).catch((error) => {
        console.log("Error getting document:", error);
    });
    }



    function myTransfer(){
           transferr.style.display ="block"
    }
    // function show(){
    //    showName.innerHTML=`
    //    <i class='bx bx-rotate-right bx-spin'></i>`
    // let accountNumber = parseInt(digits.value); 
    // let amount = payAmt.value
    // let transs = tranAmount.value
   
    // const userId = user.uid;
    // db.collection("account")
    //     .get()
    //     .then((querySnapshot) => {
    //         // let mede = []
    //         querySnapshot.forEach((doc) => {
    //         const senderData = querySnapshot.docs[0].data();
    //         const senderBalance = senderData.balance;
    //         console.log(senderData);
    //         if (senderBalance => amount)
    // db.collection("account")
    //     .where("account", "==", accountNumber)
    //     .get()
    //     .then((querySnapshot) => {
    //         if (!querySnapshot.empty) {
    //             const accountData = querySnapshot.docs[0].data();
    //             const accountId = accountData.Id
    //             const accountName = accountData.displayName; 
    //             const accountLast = accountData.last;
    //             const accountNum = accountData.account;
    //             const accountBalance = accountData.balance;
    //             console.log(accountData); 
    //             showName.innerHTML = `
    //             <i class='bx bxs-user-check'></i>
    //             ${accountName} ${accountLast} `;
    //         tranNam.innerHTML = `${accountName} ${accountLast}`;
    //         tranNum.innerHTML =`${accountNum}`
    //         const newSenderBalance = senderBalance - amount;
    //       const newAccountBalance = accountBalance + amount;
    //       senderData.update({ balance: newSenderBalance })
    //                             .then(() => {
    //                                 firestore.collection("account").doc(accountId).update({ balance: newAccountBalance })
    //                                     .then(() => {
                                            
    //                                         const receiptContent = generateTransferReceipt(amount, accountName);
    //                                         const printWindow = window.open('', '_blank');

    //                                         printWindow.document.write(`<pre>${accountData}</pre>`);
    //                                         printWindow.document.close();
    //                                         printWindow.print();
    //                                         raydee.textContent = `Account Balance: $${newSenderBalance.toFixed(2)}`;
    //                                           console.error("Error updating recipient balance:", error);
    //                                     })
    //                                 })
    //                             .catch(error => {
    //                                 console.error("Error updating sender balance:", error);
    //                             });
    //                     } else {
    //                         alert("Recipient not found.");
    //                     }
    //                 })
    //                 .catch(error => {
    //                     console.error("Error fetching recipient data:", error);
    //                 });
   
                // })
                // })    
    // } 

    // db.collection("account")
    //     .where("account", "==", accountNumber)
    //     .get()
    //     .then((querySnapshot) => {
    //         if (!querySnapshot.empty) {
    //             const accountData = querySnapshot.docs[0].data();
    //             const accountName = accountData.name; 
    //             const accountLast = accountData.last;
    //             const accountNum = accountData.account;
    //             const accountBalance = accountData.balance;
    //             console.log(accountData); 
    //             showName.innerHTML = `
    //             <i class='bx bxs-user-check'></i>
    //             ${accountName} ${accountLast} `;
    //         tranNam.innerHTML = `${accountName} ${accountLast}`;
    //         tranNum.innerHTML =`${accountNum}`


    //         } else {
    //             showName.innerHTML = "Account not found.";
    //         }
 
    //     })
    // }
       
function pay(){
    if(!showName.innerHTML==""){
        transferr.style.display ="none"
     payment.style.display ="block"
    }
   
    // trans.style.top ="100%"

}
function showPin(){
    if(payAmt.value !==""){
        // payment.style.display ="none"
        trans.style.display = "block"
    }
    tranAmount.innerHTML = payAmt.value
    tranRem.innerHTML = rem.value

}

// 
// async function finalPay() {
//     const user = firebase.auth().currentUser;
//     try {
//         const senderUID = user.uid;
//         const receiverAccount = parseInt(tranNum.innerText);
//         const transferAmount = parseFloat(tranAmount.innerText);
//         const transferRemark = tranRem.innerText || "Transfer";

//         const senderRef = db.collection("account").doc(senderUID);
//         const receiverRef = db.collection("account").doc(receiverAccount.toString());

//         const transaction = db.runTransaction(async (transaction) => {
//             const senderSnapshot = await transaction.get(senderRef);
//             const receiverSnapshot = await transaction.get(receiverRef);

//             const senderData = senderSnapshot.data();
//             const receiverData = receiverSnapshot.data();

//             if (!senderData || !receiverData) {
//                 throw new Error("Sender or receiver not found.");
//             }

//             if (senderData.balance < transferAmount) {
//                 throw new Error("Insufficient balance.");
//             }

//             const newSenderBalance = senderData.balance - transferAmount;
//             const newReceiverBalance = receiverData.balance + transferAmount;

//             transaction.update(senderRef, { balance: newSenderBalance });
//             transaction.update(receiverRef, { balance: newReceiverBalance });
//         });

//         await transaction;

        
//         alert("Money transfer successful!");
//         raydee.innerHTML = newSenderBalance.toFixed(2);

//     } catch (error) {
//         alert("Money transfer failed: " + error.message);
//     }
// }





   

    
</script>
<script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"></script>
<script>
    let bot = document.querySelector('#bot');
    let aside = document.querySelector('.aside');

    bot.onclick = function () {
        aside.classList.toggle('active');

    };
</script>