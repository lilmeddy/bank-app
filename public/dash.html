<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="dash.css">
    <script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore-compat.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
</head>

<body>
    <div id="scrn" style=" font-size: 150px; width: 20%; height: 50%; margin: 200px auto;">
        <i class='bx bx-rotate-right bx-spin bx-rotate-90' style="color: blue;"></i>
    </div>
    <aside class="aside" id="load">

        <div class="top" style="padding-top: 15px;">
            <i class="bx bx-menu" id="bot" style="padding-top: 15px;"></i>
            <div class="logo">
                <img src="https://dashboard.piggyvest.com/static/media/piggyvest-logo.0b78a8fa.svg" alt="">
            </div>

        </div>
        <ul class="ul">
            <li class="li">
                <a href="" class=" sap">
                    <i class='bx bxs-home'></i>
                    <span class="nav-item">Home</span>
                </a>
            </li>

            <li class="li">
                <a href="save.html" class=" sap save">
                    <i class='bx bx-target-lock'></i>
                    <span class="nav-item">Savings</span>
                </a>
            </li>

            <li class="li">
                <a href="" class=" sap">
                    <i class='bx bxs-rocket'></i>
                    <span class="nav-item">Invest</span>
                </a>
            </li>

            <li class="li">
                <a href="account.html" class=" sap">
                    <i class='bx bx-user'></i>
                    <span class="nav-item">Account</span>
                </a>
            </li>

            <li class="li move">
                <a href="Login.html" class=" sap">
                    <i class='bx bx-power-off'></i>
                    <span class="nav-item">Logout</span>
                </a>
            </li>
        </ul>

    </aside>
    <main class="main" id="screen">
        <section class="section1">
            <div class="d-flex align-items-center justify-content-between mt-3">
                <div class="name">
                    <h1 id="lastName"></h1>
                    <p>wash your hands, it's lunch time üçõ!</p>
                </div>
                <div>
                    <a href="details.html" class="btn">
                        <i class='bx bxs-user-circle bx-burst' style='color:#045dd4' id="photo"></i>
                    </a>
                </div>

        </section>
        <section>
            <div class="row">
                <div class="col-lg-1">
                    <i class='bx bxs-low-vision bx-tada'></i>
                </div>
                <div class="col-lg-11 text-end">
                    <p    class="btn nam" id="transaction">Transaction History</p>
                    <p   class="btn nam" id="fund">Fund</p>
                    <button onclick="myTransfer()" style="background-color: transparent;border: none;"><p  class="btn nam" >Transfer</p></button>
                    <p   class="btn nam" id="airtime">Buy Airtime</p>
                    <p   class="btn nam" id="save">+ QUICK SAVE</p>
                </div>
            </div>
        </section>
        <section class="overflow">
            <div class="blac" style="background-color:rgba(86, 16, 216, 0.726) ;">
                <div class="icon">
                    <i>@</i>
                </div>
                <div class="text">
                    <h1 id="firstName"></h1>
                    <p id="raydee"></p>
                </div>
            </div>
            <div class="blac" style="background-color:rgb(16,98,216) ;">
                <div class="icon">
                    <i class='bx bx-shield' style='color:#fff'></i>
                </div>
                <div class="text">
                    <h1>Total Savings</h1>
                    <p id="saving">‚Ç¶14.28</p>
                </div>
            </div>
            <div class="blac" style="background-color:rgb(121, 19, 212);">
                <div class="icon">
                    <i class='bx bx-line-chart'></i>
                </div>
                <div class="text">
                    <h1>Total Investments</h1>
                    <p id="invest">‚Ç¶14.28</p>
                </div>
            </div>
            <div class="blac" style="background-color: rgba(8, 8, 8, 0.89);">
                <div class="icon">
                    <i class='bx bx-dollar'></i>
                </div>
                <div class="text">
                    <h1>Flex Dollars</h1>
                    <p id="dollar">‚Ç¶14.28</p>
                </div>
            </div>
            <div class="blac" style="background-color: #fff;color: rgb(231,67,156); border: 1px solid #fff">
                <div class="icon">
                    <i class='bx bxs-wallet'></i>
                </div>
                <div class="text">
                    <h1>Flex Naira</h1>
                    <p id="naira">‚Ç¶14.28</p>
                </div>
            </div>

        </section>
        <section class="list-flex">
            <div class="todo">

            </div>
            <div class="best"></div>
        </section>

        <section id="transferr">
            <div class="right">
                <button onclick="back()"><i class='bx bx-chevron-left bx-flashing'></i></button>
                <p>Transfer to PiggyVest Account</p>
            </div>
            <div class="left">
                <button onclick="his()">History</button>
            </div>
            <div class="recipeient">
                <div><input id="digits" type="number" placeholder="Enter 10 digits Account Number">
                <button onclick="show()"><i class='bx bx-check'></i></button></div>
                <h1 id="showName"></h1>
                <button onclick="pay()" id="">Next</button>
            </div>
        </section>

        <section id="payment">
            <div><img src="./Images/logo.svg" alt=""></div>
            <h1 id="payName"></h1>
            <p>PiggyVest(<span id="payAcc"></span>)</p>
            <label for="">Amount</label>
            <div><span>‚Ç¶</span><input type="number" id="payAmt" placeholder="100.00-5,000,000.00"></div>
            <label for="">Remark</label><br>
            <input type="text" placeholder="What's this for?(Optional)" id="rem"><br>
            <button onclick="showPin()">Confirm</button>


            <div id="trans">

                <button onclick="bac()"><i class='bx bx-chevron-left bx-flashing'></i></button>
                <div class="payFlex">
                    <p>Bank</p>
                    <h1>PiggyVest</h1>
                </div>
                <div class="payFlex">
                    <p>Account Number</p>
                    <h1 id="tranNum"></h1>
                </div>
                <div class="payFlex">
                    <p>Name</p>
                    <h1 id="tranNam"></h1>
                </div>
                <div class="payFlex">
                    <p>Amount</p>
                    <h1 id="tranAmount"></h1>
                </div>
                <div class="payFlex">
                    <p>Remark</p>
                    <h1 id="tranRem"></h1>
                </div>
                <div>
                    <p>Payment method</p>
                </div>
                <div id="method"></div>
                <div>
                    <label for="">Enter Pin</label>
                    <input type="numbers" id="final" placeholder="Enter Pin">
                </div>
                <button onclick="finalPay()">Pay</button>
            </div>
            <div id="reciept">

            </div>
        </section>
    </main>

</body>

</html>

<script>

    const firebaseConfig = {
        apiKey: "AIzaSyCZRt5ZugU3gYBuKEWAAdbgdtCoIuizGJ4",
        authDomain: "bank-56c80.firebaseapp.com",
        projectId: "bank-56c80",
        storageBucket: "bank-56c80.appspot.com",
        messagingSenderId: "278093243224",
        appId: "1:278093243224:web:268d9c364c7d4e5f577b2d"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
</script>
<script>
    // const user = firebase.auth().currentUser;
    let lastName = document.getElementById("lastName")
    let firstName = document.getElementById("firstName")
    let raydee = document.getElementById("raydee")
    let screen = document.getElementById("screen")
    let scrn = document.getElementById("scrn")
    let load = document.getElementById("load")
    let transfer = document.getElementById("transfer")
    let transferr = document.getElementById("transferr")
    let digits = document.getElementById("digits")
    let showName = document.getElementById("showName")
    let payment = document.getElementById("payment")
    let payName = document.getElementById("payName")
    let payAcc = document.getElementById("payAcc")
    let payAmt = document.getElementById("payAmt")
    let trans = document.getElementById("trans")
    let tranNum = document.getElementById("tranNum")
    let tranNam = document.getElementById("tranNam")
    let tranAmount = document.getElementById("tranAmount")
    let method = document.getElementById("method")
    let reciept = document.getElementById("reciept")
    let rem = document.getElementById("rem")
    let tranRem = document.getElementById("tranRem")
    scrn.style.display = "block"
    screen.style.display = "none"
    load.style.display = "none"
     
    db.collection("account")
        .get()
        .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
                scrn.style.display = "none"
                screen.style.display = "block"
                load.style.display = "block"
                // doc.data() is never undefined for query doc snapshots
                // console.log(doc.id, " => ", doc.data());
                lastName.innerHTML = ` ${doc.data().last}`
                firstName.innerHTML = ` ${doc.data().name} pocket`
                raydee.innerHTML = ` ${doc.data().balance}`
            });
        })
        .catch((error) => {
            console.log("Error getting documents: ", error);
        });
    // transfer.addEventListener("click",myTransfer);
    function myTransfer(){
           transferr.style.display ="block"
    }
    function show(){
       showName.innerHTML=`
       <i class='bx bx-rotate-right bx-spin'></i>`
    let accountNumber = parseInt(digits.value); 
    db.collection("account")
        .where("account", "==", accountNumber)
        .get()
        .then((querySnapshot) => {
            if (!querySnapshot.empty) {
                const accountData = querySnapshot.docs[0].data();
                const accountName = accountData.name; 
                const accountLast = accountData.last;
                const accountNum = accountData.account;
                console.log(accountData); 
                showName.innerHTML = `
                <i class='bx bxs-user-check'></i>
                ${accountName} ${accountLast} `;
            tranNam.innerHTML = `${accountName} ${accountLast}`;
            tranNum.innerHTML =`${accountNum}`
            } else {
                showName.innerHTML = "Account not found.";
            }
        })
        .catch((error) => {
            console.log("Error checking account: ", error);
        });
}

function pay(){
    if(!showName.innerHTML==""){
        transferr.style.display ="none"
     payment.style.display ="block"
    }
   
    // trans.style.top ="100%"

}
function showPin(){
    if(payAmt.value !==""){
        // payment.style.display ="none"
        trans.style.display = "block"
    }
    tranAmount.innerHTML = payAmt.value
    tranRem.innerHTML = rem.value

}

    function finalPay(senderName, recipientAccountNumber, enteredPin, transferAmount) {

 
    //  
    db.collection("account")
        .where("account", "==", )
        .get()
        .then(senderQuerySnapshot => {
            if (senderQuerySnapshot.empty) {
                console.log("Sender account not found.");
                return;
            }

            const senderData = senderDoc.data();
            const senderBalance = senderData.balance;
            const correctPin = senderData.pin;

            if (enteredPin !== correctPin) {
                console.log("Incorrect pin.");
                return;
            }

            const transferAmount = tranAmount.innerHTML;
            const recipientName = tranNam.innerHTML;
            const recipientNumber = parseInt(tranNum.innerHTML);

            if (senderBalance < transferAmount) {
                console.log("Insufficient balance.");
                return;
            }
            db.collection("account")
                .where("account", "==", recipientAccountNumber)
                .get()
                .then(recipientQuerySnapshot => {
                    if (recipientQuerySnapshot.empty) {
                        console.log("Recipient account not found.");
                        return;
                    }
                    const recipientDoc = recipientQuerySnapshot.docs[0];
                    const recipientData = recipientDoc.data();
                    const recipientBalance = recipientData.balance;

                    const newSenderBalance = senderBalance - transferAmount;
                    const newRecipientBalance = recipientBalance + transferAmount;

                    senderDoc.ref.update({ balance: newSenderBalance })
                    .then(() => {
                            recipientDoc.ref.update({ balance: newRecipientBalance })
                                .then(() => {
                                    const transactionRecord = {
                                        sender: senderName,
                                        recipient: recipientName,
                                        amount: transferAmount,
                                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                                        // remark: tranRem.innerHTML
                                    };
                                    db.collection("transactionHistory").add(transactionRecord)
                                        .then(() => {
                                            console.log("Transfer successful.");
                                        })
                                        .catch(error => {
                                            console.error("Error adding transaction record:", error);
                                        })
                                   .catch(error=> {
                                    console.error("Error updating recipient balance:", error);
                                });
                        })
                        .catch(error => {
                            console.error("Error updating sender balance:", error);
                        });
                })
                .catch(error => {
                    console.error("Error checking recipient account:", error);
                });
        })
        .catch(error => {
            console.error("Error checking sender account:", error);
        });

});
// })
    } 
    
</script>
<script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"></script>
<script>
    let bot = document.querySelector('#bot');
    let aside = document.querySelector('.aside');

    bot.onclick = function () {
        aside.classList.toggle('active');

    };
</script>